#{extends 'content.html' /}
#{set title:user.userName /}

#{if currentUserProfilePage}
    #{set currentMenu:'menuProfile' /}
#{/if}
#{else}
    #{set currentMenu:'menuExperts' /}
#{/else}

#{set contentCenterClass:'large' /}

#{userContainer user:user}

<!-- mon porfil -->
<div class="myprofil">
    <div class="leftprofil">
        <div class="avatar-profil">
                <img src="@{Application.showAvatar(user.id, 'large')}" id="cropbox" />
        </div>
        <div class="linksprofil">
            #{isConnected}
            <a href="#" onClick="return toggleFollowingUser(${user.id});" class="addfav #{if controllers.CurrentUser.getCurrentUser().isFollowingUser(user)}active#{/if}#{else}inactive#{/else}">Add to favorite</a>
            #{/isConnected}
            <a href="#" class="sendmail" id="link-sendmail">Send a message</a>
        </div>
    </div>
    <div class="info-profil">
        <h2>${user.userName} #{if user.realName}(${user.realName})#{/if}</h2>
        <p class="resume">${user.description}</p>
    </div>
    <hr class="clear"/>
    <div class="boxmail" id="boxlink-sendmail">
        <form id="sendMessageForm">
            <div class="item-textarea">
                <textarea cols="20" rows="5" id="messageUserContent"  name="content"></textarea>
            </div>
            <input type="hidden" name="id" value="${user.id}" />
            <div class="item-submit">
                <button><span class="backbutton"></span><span class="txtbutton cuf-newaccount">&{'messagesubmit'}</span></button>
            </div>
        </form>
    </div>
    <p id="messagesentconfirm" style="display:none;">&{'messagesentconfirm'}</p>

</div>

<div class="mybadges">
    <h2 class="cuf-grb">&{'userratings'}</h2>
    <div class="liststars">
    #{list items:user.categoryScores, as:'categoryScore' }
        <div class="colvote">
            <h3>${categoryScore.category.label}</h3>
            ${categoryScore.score}
            <div class="vote">
                <span class="star fullstar">vote plein</span>
                <span class="star fullstar">vote plein</span>
                <span class="star demistar">vote demi-plein</span>
                <span class="star emptystar">vote vide</span>
                <span class="star emptystar">vote vide</span>
            </div>
        </div>
    #{/list}
    </div>
</div>
<hr class="clear"/>

<!-- TODO COLORZ : add filters -->
<div class="listinsights">
    #{if currentUserProfilePage}
    <h2 class="cuf-grb">&{'myinsights'}</h2>
    #{/if}
	#{else}
    <h2 class="cuf-grb">&{'userinsights'}</h2>	   
    #{/else}
    <ul>
        #{listInsights insights:lastInsights /}
    </ul>
</div>

#{isConnected}
#{secure.check 'admin'}
<div class="admin">
    <h3>admin box</h3>
    <p>${user.invitationsLeft} invitations left.</p>
    #{form @Admin.addInvitationsToUser(user.id) }
        <input type="text" name="number" />
        <input type="submit" name="submit" value="Add" />
    #{/form}
</div>
#{/secure.check}
#{/isConnected}

#{/userContainer}