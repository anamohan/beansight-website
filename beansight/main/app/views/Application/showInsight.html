#{extends 'content.html' /}
#{set title:insight.content /}

#{set currentMenu:'menuInsights' /}

#{set contentCenterClass:'large' /}

#{insightContainer insight:insight}

<div class="single">
    <div class="s-header">
        <p class="s-intro">#{isConnected}#{followInsightWidget insight:insight /}#{/isConnected}
        &{'creationdate'} ${insight.creationDate.since(true)} &{'createdby'} <a href="@{Application.showUser(insight.creator.userName)}" class="s-author">${insight.creator.userName}</a>
         &{'createdin'} <a href="#" class="link-cat">${insight.category.label}</a></p>
         
        <ul class="list-tags">
            #{isConnected}<li class="link-new"><a href="#" id="showMoreTags">&{'suggesttags'}</a></li>#{/isConnected}
            
            #{list items:insight.tags, as:'tag' }
            <li><a href="#">${tag.label}</a></li>
            #{/list}
        </ul>
        <div id="moreTags" style="display:none;">
        #{form @Application.addTags(insight.uniqueId)}
            <input type="text" name="tagLabelList" id="tagLabelList" />
            <input type="submit" value="&{'addtags'}"/>
        #{/form}
        </div>
    </div>
    <div class="s-content">
        <h2>${insight.content}</h2>
        <p class="insightdate">&{'enddate'} ${insight.endDate.format("dd MMMM yyyy")}</p>
        
        <div class="graphzone">
            <div class="leftgraph">
                
			    #{if insight.validated}
			        <p>&{'validation'} (TODO) ${insight.validationScore}</p>
			    #{/if}

                #{isConnected}
                    #{agree-disagreeWidgetLarge insight:insight, lastUserVote:lastUserVote /}
                #{/isConnected}

                <div class="lastvoters">
                    <p>&{'lastvoters'}</p>
                    <ul class="listvoters">
                    #{list items:lastVotes, as:'vote'}
                        <li>#{userMiniAvatarVote vote:vote /}</li>
                    #{/list}
                    </ul>
                    <hr class="clear"/>
                </div>
            </div>
            
            <div class="graphique">
                <img src="http://chart.apis.google.com/chart?chf=bg,s,FFFFFF&chs=316x148&chco=76A4FB,FF0000&cht=ls&chd=t:${agreeTrends.join(",")}" alt=""/>
            </div>
            <hr class="clear"/>
        </div>
        
        #{shareInsight insight:insight /}
        
        <div class="commentzone">
            <p class="nbcomments"><span class="cuf-grm">${insight.comments.size()}</span> <span class="cuf-grb">&{'comments'}</span></p>
            #{isConnected}
            <form class="newcomment" id="addCommentForm">
                
                <div class="comment-author">
                    <a href="#">
                        ${controllers.CurrentUser.getCurrentUserName()}
                        <span class="img-author">
                            <img src="@{Application.showAvatar( controllers.CurrentUser.getCurrentUser().id, 'small')}"/>
                        </span>
                    </a>
                </div>
                <div class="input-textarea">
                    <textarea cols="20" rows="4" name="content"></textarea>
                </div>
                <input name="uniqueId" type="hidden" value="${insight.uniqueId}"/>

                <hr class="clear"/>
                <div class="input-submit">
                    <button><span class="backbutton"></span><span class="txtbutton cuf-newaccount">&{'postcomment'}</span></button>
                    <!--<input type="submit" name="submit-comment" value="Add a comment"/>-->
                </div>
                <hr class="clear"/>
            </form>
            #{/isConnected}

            <div id="commentList" class="list-comments">
            #{list items:insight.comments, as:'comment' }
            #{comment comment:comment /}
            #{/list}
            </div>

        </div>
    </div>
</div>
    
#{/insightContainer}
