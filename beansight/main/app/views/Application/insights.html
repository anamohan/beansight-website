#{extends 'content.html' /}
#{set 'title'}
    &{'exploreinsights'}
#{/set}

#{set currentMenu:'menuInsights' /}

#{set contentCenterClass:'large' /}

<h2 class="cuf-grb">&{'insightstitle'} #{if category} &{'incategory'} ${category}#{/if}</h2>

<div class="listinsights">
    <ul class="menulistinsights">
        <li class="sortby">&{'insights.sortby'}</li>
        <li class="first"><a href="@{Application.insights("trending", category?.id, langs)}" #{if sortBy == null || sortBy?.equals("trending")}class="current"#{/if}>&{'insights.trending'}</a></li>
        <li><a href="@{Application.insights("updated", category?.id, langs)}" #{if sortBy?.equals("updated")}class="current"#{/if}>&{'insights.latest'}</a></li>
    *{
        <li><a href="#">trending</a></li>
        <li><a href="#">incoming</a></li>
        
     }*
     	<li class="sortby">&{'insights.category'}</li>
	    <li>
		    <div class="filterDropDown">
		    <select name="categoryId" id="filterCategory">
		       <option value="@{Application.insights(sortBy, 0, langs)}" #{if category == null}selected#{/if}>All</option>
			   #{list items:controllers.Application.getCategories(), as:'cat'}
			       <option value="@{Application.insights(sortBy, cat.id, langs)}" #{if category && category.id == cat.id}selected#{/if}>${cat.label}</option>
			   #{/list}
			</select>
			</div>
	    </li>
        
      *{
        <li><a href="#">Favorites</a></li>
       }* 
    </ul>
    
    <ul id="insightList">
        #{listInsights insights:insights /}
    </ul>

    <div id="moreResults" class="seeall">
        <p><a id="moreInsights" href="#">&{'insights.more'}</a></p>
    </div>
</div>

<script type="text/javascript">
// TODO check if a "more" button should be displayed
//if( $("#insightList li").length >= ${controllers.Application.NUMBER_INSIGHTS_INSIGHTPAGE} ) {
//        $("#moreResults").fadeIn(2000);
//   }
var insightsFrom = ${controllers.Application.NUMBER_INSIGHTS_INSIGHTPAGE};

/** get more insights */
$("#moreInsights").click( function() {
    $.ajax( {
        url: moreInsightsAction(),
        data: {"from":insightsFrom#{if sortBy}, "sortBy": "${sortBy}"#{/if}#{if category}, "cat": ${category.id}#{/if}#{if langs}, "lang": [#{list items:langs, as:'langstring'}"${langstring}"#{if !langstring_isLast}, #{/if}#{/list}]#{/if} },
        success: onMoreInsightsSuccess
    } );
    return false;
});

function onMoreInsightsSuccess(content) {
    $("#insightList").append(content);
    insightsFrom += ${controllers.Application.NUMBER_INSIGHTS_INSIGHTPAGE};
    // TODO disable the "more button" if less results than the number to display
    //if( $(content).length < ${controllers.Application.NUMBER_INSIGHTS_INSIGHTPAGE} ) {
    //    $("#moreResults").fadeOut(1000);
    //}
}
</script>

<script type="text/javascript" charset="utf-8">
// keyboard shortcuts
/*
var shortcutCurrentInsight = 1;
$(document).bind("keydown", "j", function () {
    shortcutCurrentInsight++;
}).bind("keydown", "k", function () {
    if(shortcutCurrentInsight > 1) {
        shortcutCurrentInsight--;
    }
}).bind("keydown", "Return", function () {
    var shortcutTarget = $("a.permalink", "#insightList .insightItem:nth-child(" + shortcutCurrentInsight + ")").attr("href");
    if (shortcutTarget != null && shortcutTarget != "") {
        window.location.href = shortcutTarget;
    }
});
*/
</script>