#{extends 'mainConnected.html' /}
#{set title:'Home' /}

#{set currentMenu:'menuHome' /}

<div class="prepend-2 span-16">
    #{listInsights insights:insights /}
</div>

<div class="span-4 last">
<div class="sideBox">
    #{myInsights/}
    #{myFollowedInsights/}
</div>
</div>

<script type="text/javascript" charset="utf-8"><!--

    /** Called when an AJAX request returns an error */
    $("#error").ajaxError(function(event, request, settings){
        $(this).text('Sorry, an error occured during last action.');
    });

    /** Current user agree an insight */
    function agree(insightId) {
        var agreeAction = #{jsAction @Application.agree(':insightId') /};
        $.getJSON(agreeAction({'insightId': insightId}), onVoteSuccess);
    }
    
    /** Current user disagree an insight */
    function disagree(insightId) {
        var disagreeAction = #{jsAction @Application.disagree(':insightId') /};
        $.getJSON(disagreeAction({'insightId': insightId}), onVoteSuccess);
    }
    
    /** Callback after a vote is done */
    function onVoteSuccess(data) {
        updateAgreeDisagreeCount(data.id, data.updatedAgreeCount, data.updatedDisagreeCount);
    }

    /** Update the counts of an insight, given new counts */
    function updateAgreeDisagreeCount(id, agreeCount, disagreeCount) {
        $("#agreeCount_" + id).text(agreeCount);
        $("#disagreeCount_" + id).text(disagreeCount);
    }

    
--></script>

